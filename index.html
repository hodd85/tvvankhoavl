<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qu·∫£n l√Ω kh√°ch h√†ng - Bootstrap</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    #video {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .photo-list img {
      width: 100px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<div class="container my-4">
  <h2 class="mb-4 text-center">Qu·∫£n l√Ω kh√°ch h√†ng</h2>

  <!-- Nav tabs -->
  <ul class="nav nav-tabs mb-3" id="modeTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="create-tab" data-bs-toggle="tab" data-bs-target="#create" type="button" role="tab" aria-controls="create" aria-selected="true">T·∫°o kh√°ch</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="search-tab" data-bs-toggle="tab" data-bs-target="#search" type="button" role="tab" aria-controls="search" aria-selected="false">T√¨m kh√°ch</button>
    </li>
  </ul>

  <div class="tab-content" id="modeTabsContent">
    <!-- T·∫°o kh√°ch -->
    <div class="tab-pane fade show active" id="create" role="tabpanel" aria-labelledby="create-tab">
      <form id="createForm" class="mb-3">
        <div class="mb-3">
          <label for="inputName" class="form-label">H·ªç t√™n</label>
          <input type="text" class="form-control" id="inputName" placeholder="Nh·∫≠p h·ªç t√™n" required />
        </div>
        <div class="mb-3">
          <label for="inputPhone" class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
          <input type="tel" class="form-control" id="inputPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required />
        </div>
        <div class="mb-3">
          <label for="inputDate" class="form-label">Ng√†y mua</label>
          <input type="date" class="form-control" id="inputDate" required />
        </div>
        <div class="mb-3">
          <label for="inputAmount" class="form-label">S·ªë ti·ªÅn</label>
          <input type="number" class="form-control" id="inputAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn" min="0" required />
        </div>

        

        <video id="video" autoplay muted playsinline style="display:none;" class="mb-3 rounded"></video>
		<div class="mb-3">
          <label class="form-label">Ch·ª•p ·∫£nh</label><br />
          <button type="button" id="btnStartCamera" class="btn btn-primary me-2">B·∫≠t camera</button>
          <button type="button" id="btnTakePhoto" class="btn btn-success me-2" style="display:none;">Ch·ª•p ·∫£nh</button>
          <button type="button" id="btnStopCamera" class="btn btn-danger me-2" style="display:none;">T·∫Øt camera</button>
          <button type="button" id="btnSwitchCamera" class="btn btn-secondary" style="display:none;" title="Chuy·ªÉn camera">üîÑ</button>
        </div>

        <div class="photo-list mb-3 d-flex flex-wrap" id="photoList"></div>

        <button type="submit" class="btn btn-success">L∆∞u kh√°ch</button>
      </form>
    </div>

    <!-- T√¨m kh√°ch -->
    <div class="tab-pane fade" id="search" role="tabpanel" aria-labelledby="search-tab">
      <div class="input-group mb-3">
        <input type="tel" id="searchPhone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·∫ßn t√¨m" aria-label="S·ªë ƒëi·ªán tho·∫°i" />
        <button class="btn btn-outline-secondary" type="button" id="btnSearchPhone">üîç T√¨m</button>
      </div>

      <ul class="list-group" id="searchResults"></ul>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle (Popper + Bootstrap JS) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const customers = [];
  let photos = [];

  const video = document.getElementById('video');
  const btnStartCamera = document.getElementById('btnStartCamera');
  const btnTakePhoto = document.getElementById('btnTakePhoto');
  const btnStopCamera = document.getElementById('btnStopCamera');
  const btnSwitchCamera = document.getElementById('btnSwitchCamera');
  const photoList = document.getElementById('photoList');

  let stream = null;
  let usingFrontCamera = true; // m·∫∑c ƒë·ªãnh camera tr∆∞·ªõc

  // Set default date h√¥m nay cho inputDate
  document.getElementById('inputDate').valueAsDate = new Date();

  btnStartCamera.addEventListener('click', async () => {
    try {
      const constraints = {
        video: { facingMode: usingFrontCamera ? 'user' : 'environment' }
      };
      stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;
      video.style.display = 'block';
      btnTakePhoto.style.display = 'inline-block';
      btnStopCamera.style.display = 'inline-block';
      btnStartCamera.style.display = 'none';
      btnSwitchCamera.style.display = 'inline-block';
    } catch (error) {
      alert('Kh√¥ng th·ªÉ m·ªü camera: ' + error.message);
    }
  });

  btnTakePhoto.addEventListener('click', () => {
    if (!stream) return;

    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 320;
    canvas.height = video.videoHeight || 240;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imgUrl = canvas.toDataURL('image/png');

    photos.push(imgUrl);
    renderPhotos();
  });

  btnStopCamera.addEventListener('click', () => {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      stream = null;
    }
    video.style.display = 'none';
    btnTakePhoto.style.display = 'none';
    btnStopCamera.style.display = 'none';
    btnStartCamera.style.display = 'inline-block';
    btnSwitchCamera.style.display = 'none';
  });

  btnSwitchCamera.addEventListener('click', async () => {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }
    usingFrontCamera = !usingFrontCamera;
    try {
      const constraints = {
        video: { facingMode: usingFrontCamera ? 'user' : 'environment' }
      };
      stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;
    } catch (error) {
      alert('Kh√¥ng th·ªÉ chuy·ªÉn camera: ' + error.message);
    }
  });

  function renderPhotos() {
    photoList.innerHTML = '';
    photos.forEach((src, idx) => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = `·∫¢nh ${idx + 1}`;
      img.title = `·∫¢nh ${idx + 1}`;
      photoList.appendChild(img);
    });
  }

  // X·ª≠ l√Ω l∆∞u kh√°ch
  document.getElementById('createForm').addEventListener('submit', (e) => {
    e.preventDefault();

    const name = document.getElementById('inputName').value.trim();
    const phone = document.getElementById('inputPhone').value.trim();
    const date = document.getElementById('inputDate').value;
    const amountStr = document.getElementById('inputAmount').value;
    const amount = parseFloat(amountStr);

    if (!name || !phone || !date || isNaN(amount) || amount < 0) {
      alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† h·ª£p l·ªá th√¥ng tin kh√°ch h√†ng.');
      return;
    }

    customers.push({ name, phone, date, amount, photos: [...photos] });
    alert('L∆∞u kh√°ch h√†ng th√†nh c√¥ng!');

    // Reset form v√† ·∫£nh
    e.target.reset();
    document.getElementById('inputDate').valueAsDate = new Date();
    photos = [];
    renderPhotos();

    // T·∫Øt camera n·∫øu ƒëang b·∫≠t
    if (stream) btnStopCamera.click();
  });

  // T√¨m ki·∫øm kh√°ch
  document.getElementById('btnSearchPhone').addEventListener('click', () => {
    const query = document.getElementById('searchPhone').value.trim();
    const resultsContainer = document.getElementById('searchResults');
    resultsContainer.innerHTML = '';

    if (!query) {
      alert('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ t√¨m.');
      return;
    }

    const matched = customers.filter(cust => cust.phone.includes(query));

    if (matched.length === 0) {
      resultsContainer.innerHTML = `<li class="list-group-item">Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng n√†o.</li>`;
      return;
    }

    matched.forEach((cust) => {
      const li = document.createElement('li');
      li.classList.add('list-group-item');
      li.innerHTML = `
        <strong>H·ªç t√™n:</strong> ${cust.name}<br/>
        <strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${cust.phone}<br/>
        <strong>Ng√†y mua:</strong> ${cust.date}<br/>
        <strong>S·ªë ti·ªÅn:</strong> ${cust.amount.toLocaleString()}<br/>
        <div class="d-flex flex-wrap mt-2">
          ${cust.photos.map((p) => `<img src="${p}" alt="·∫¢nh kh√°ch" style="width:80px; margin-right:5px; border-radius:4px; border:1px solid #ccc;">`).join('')}
        </div>
      `;
      resultsContainer.appendChild(li);
    });
  });
</script>
</body>
</html>
